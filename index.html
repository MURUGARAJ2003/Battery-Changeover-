<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Battery Changeover Monitor</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f7f7f7;
    }
    h2 {
      color: #333;
    }
    #status {
      padding: 15px;
      margin-bottom: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #4CAF50;
      color: white;
    }
    tr:nth-child(even) {
      background: #f2f2f2;
    }
  </style>
</head>
<body>
  <h2>ðŸ”‹ Battery Changeover System</h2>

  <!-- Current Status -->
  <div id="status">
    <h3>Current Status</h3>
    <p><b>Date:</b> <span id="curDate">--</span></p>
    <p><b>Time:</b> <span id="curTime">--</span></p>
    <p><b>Battery 1:</b> <span id="bat1v">--</span> V | <span id="bat1t">--</span> Â°C</p>
    <p><b>Battery 2:</b> <span id="bat2v">--</span> V | <span id="bat2t">--</span> Â°C</p>
    <p><b>Load Voltage:</b> <span id="load">--</span> V</p>
    <p><b>Active Battery:</b> <span id="active">--</span></p>
  </div>

  <!-- History -->
  <h3>ðŸ“œ History Logs</h3>
  <div id="history"></div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAPgh051TeLWe6SPtVhk_A241addyIyfUM",
      authDomain: "lithium-ion-battery-changeover.firebaseapp.com",
      databaseURL: "https://lithium-ion-battery-changeover-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "lithium-ion-battery-changeover",
      storageBucket: "lithium-ion-battery-changeover.appspot.com",
      messagingSenderId: "186918574175",
      appId: "1:186918574175:web:942c0ba9fb678c447ce3ea"
    };

    // Init Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Current Status (latest entry from History)
    db.ref("History").limitToLast(1).on("value", (snapshot) => {
      const data = snapshot.val();
      if (!data) return;
      const key = Object.keys(data)[0];
      const record = data[key];

      document.getElementById("curDate").textContent = record.Date;
      document.getElementById("curTime").textContent = record.Time;
      document.getElementById("bat1v").textContent = record.Battery1.Voltage.toFixed(2);
      document.getElementById("bat1t").textContent = record.Battery1.Temperature.toFixed(1);
      document.getElementById("bat2v").textContent = record.Battery2.Voltage.toFixed(2);
      document.getElementById("bat2t").textContent = record.Battery2.Temperature.toFixed(1);
      document.getElementById("load").textContent = record.LoadVoltage.toFixed(2);
      document.getElementById("active").textContent = record.ActiveBattery;
    });

    // History Logs
    db.ref("History").on("value", (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      let html = "<table><tr><th>Date</th><th>Time</th><th>Bat1 (V)</th><th>Bat1 (Â°C)</th><th>Bat2 (V)</th><th>Bat2 (Â°C)</th><th>Load (V)</th><th>Active</th></tr>";
      Object.keys(data).reverse().forEach((key) => {
        const r = data[key];
        html += `<tr>
          <td>${r.Date}</td>
          <td>${r.Time}</td>
          <td>${r.Battery1.Voltage.toFixed(2)}</td>
          <td>${r.Battery1.Temperature.toFixed(1)}</td>
          <td>${r.Battery2.Voltage.toFixed(2)}</td>
          <td>${r.Battery2.Temperature.toFixed(1)}</td>
          <td>${r.LoadVoltage.toFixed(2)}</td>
          <td>${r.ActiveBattery}</td>
        </tr>`;
      });
      html += "</table>";
      document.getElementById("history").innerHTML = html;
    });
  </script>
</body>
</html>
